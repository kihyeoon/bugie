# 인증 시스템 요구사항 명세서

## 1. 개요

Bugie 앱의 사용자 인증 시스템은 소셜 로그인을 통해 간편하고 안전한 접근을 제공합니다. 
사용자는 Google, Apple, Kakao 계정을 통해 로그인할 수 있으며, 첫 로그인 시 프로필 설정을 완료해야 합니다.

## 2. 기능적 요구사항

### 2.1 소셜 로그인

#### 2.1.1 지원 플랫폼
- **Google OAuth 2.0**
  - 웹과 네이티브 모두 지원
  - Google 계정 이메일 및 프로필 정보 수집
  
- **Apple Sign In**
  - iOS 네이티브 앱에서 필수
  - 웹에서도 지원
  - 사용자 이메일 숨김 옵션 처리
  
- **Kakao 로그인**
  - 한국 사용자를 위한 필수 옵션
  - 카카오톡 계정 연동

#### 2.1.2 로그인 프로세스
1. 사용자가 소셜 로그인 버튼 클릭
2. OAuth 제공자 인증 페이지로 리다이렉트
3. 사용자 인증 및 권한 동의
4. 앱으로 리다이렉트 with 인증 코드
5. Supabase가 토큰 교환 및 사용자 생성/조회
6. 신규 사용자는 프로필 설정, 기존 사용자는 홈 화면

#### 2.1.3 자동 로그인
- 로그인 성공 시 토큰을 안전하게 저장
- 앱 재시작 시 저장된 토큰으로 자동 인증
- 토큰 만료 시 자동 갱신

### 2.2 프로필 관리

#### 2.2.1 프로필 설정 (신규 사용자)
- **닉네임**
  - 필수 입력
  - 2-20자 제한
  - 특수문자 제한 (한글, 영문, 숫자, 공백만 허용)
  
- **프로필 사진**
  - 선택 사항
  - 소셜 계정 프로필 사진 기본 제공
  - 변경 옵션 제공
  
- **기본 통화**
  - 필수 선택
  - 기본값: KRW (한국 원)
  - 드롭다운 선택 (KRW, USD, JPY, EUR 등)
  
- **이용약관 동의**
  - 필수 약관 동의
  - 선택 약관 (마케팅 수신 등)
  - 약관 내용 보기 링크

#### 2.2.2 프로필 수정
- 로그인 후 언제든 프로필 수정 가능
- 닉네임, 프로필 사진, 통화 변경
- 이메일은 변경 불가 (소셜 계정 연동)

### 2.3 세션 관리

#### 2.3.1 토큰 관리
- JWT 토큰 사용
- Access Token: 1시간 유효
- Refresh Token: 30일 유효
- 자동 토큰 갱신 (만료 5분 전)

#### 2.3.2 로그아웃
- 명시적 로그아웃 버튼 제공
- 로컬 토큰 삭제
- Supabase 세션 종료
- 로그인 화면으로 리다이렉트

#### 2.3.3 세션 만료 처리
- 토큰 만료 시 자동 갱신 시도
- 갱신 실패 시 로그인 화면으로 이동
- 진행 중인 작업 임시 저장

## 3. 비기능적 요구사항

### 3.1 성능
- 로그인 응답 시간 < 2초
- 프로필 설정 저장 < 1초
- 토큰 갱신은 백그라운드에서 처리

### 3.2 보안
- OAuth 2.0 표준 준수
- HTTPS 필수
- 토큰은 안전한 저장소에 보관
  - 웹: httpOnly 쿠키
  - 네이티브: SecureStore
- CSRF 방지

### 3.3 사용성
- 직관적인 소셜 로그인 버튼
- 로딩 상태 명확히 표시
- 에러 메시지 사용자 친화적
- 다국어 지원 준비 (한국어/영어)

### 3.4 호환성
- 웹: Chrome, Safari, Edge 최신 버전
- iOS: 15.0 이상
- Android: API 26 (8.0) 이상

## 4. 제약 사항

### 4.1 기술적 제약
- Supabase Auth 사용 필수
- 이메일/비밀번호 로그인은 MVP에서 제외
- 소셜 로그인만 지원

### 4.2 비즈니스 제약
- 개인정보는 최소 수집 원칙
- GDPR, 개인정보보호법 준수
- 14세 미만 가입 제한

## 5. 인터페이스 요구사항

### 5.1 UI 요구사항
- 브랜드 일관성 유지
- 다크모드 지원
- 반응형 디자인 (웹)
- 네이티브 플랫폼 가이드라인 준수

### 5.2 API 요구사항
- Supabase Auth API 사용
- RESTful 원칙 준수
- 에러 응답 표준화

## 6. 데이터 요구사항

### 6.1 저장 데이터
- 사용자 ID (UUID)
- 이메일
- 닉네임
- 프로필 사진 URL
- 기본 통화
- 시간대
- 약관 동의 내역
- 가입일시, 수정일시

### 6.2 데이터 보안
- 민감 정보 암호화
- 프로필 사진은 CDN 저장
- 개인정보 열람/수정/삭제 권한

## 7. 테스트 요구사항

### 7.1 기능 테스트
- 각 소셜 로그인 성공/실패
- 프로필 설정 유효성 검사
- 세션 유지 및 갱신
- 로그아웃 동작

### 7.2 비기능 테스트
- 로그인 응답 시간 측정
- 동시 사용자 부하 테스트
- 보안 취약점 스캔
- 크로스 브라우저 테스트

## 8. 향후 확장 고려사항

- 이메일/비밀번호 로그인 추가
- 2단계 인증 (2FA)
- 생체 인증 (Touch ID, Face ID)
- SSO (Single Sign-On) 기업용
- 소셜 계정 연결/해제 기능